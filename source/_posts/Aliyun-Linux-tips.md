---
title: Linux操作系统加固和经验总结
date: 2018-11-21 21:36:15
tags: life
---

## Linux tips from aliyun

# 一. 背景

* 整理出开发中常见的笔记，发现阿里云上有已经很不错的参考文档
* 前几天同事`rm -rf  /data/`不小心删除了服务器的文件导致了事故
<!--more-->
* ![Xnip2019-11-21_22-08-49.jpg](https://i.loli.net/2019/11/21/idqaSKc9sgMHeQR.jpg)
# 二. 步骤
* 以后执行rm -rf 替换成mv /tmp目录，然后再写crontab script 每隔7天定时清空/tmp
```shell
1. 在/usr/local/bin/目录下vim rm2tmp.sh
  TRASH_DIR=/tmp/.trash"  
  for i in $*; do  
  STAMP=`date +%m-%d-%H:%M:%S`  
  fileName=`basename $i`  
  mv $i $TRASH_DIR/$fileName.$STAMP  
  done
2. vim ~/.bashrc 在底部添加 alias rm="sh /usr/local/bin/rm2tmp.sh"
   然后source ~/.bashrc
3. 最后 crontab -e 新增 0 2 * * 0 rm -rf /tmp/.trash 每周日凌晨2点删除/tmp目录下的垃圾文件
```
* `find ./ sort | xargs md5` 查看当前目录下排序后的文件md5

* `ubuntu`修改默认内核版本以及禁止自动升级 `https://www.jianshu.com/p/c76bc5e113f1`

* `ubuntu` 默认`desktop`版本会安装dnsmasq，修改`/etc/resolv.conf`重启后不会生效

  ```shell
  # cat /etc/resolv.conf 
  # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
  #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN       注意看：
  
  1 /etc/resolv.conf 其实是一个Link
  
  它其实指向的是 /run/resolvconf/resolv.conf 
  
  3 如果想自己定义 nameserver，那么有以下2个办法：
  
  A 在网卡的配置文件/etc/network/interfaces 里面加：
  
  dns-nameservers 192.168.3.45 192.168.8.10
  
  dns-search foo.org bar.com 
  
  重启网络
  
  sudo service networking restart 
  或者
  sudo /etc/init.d/networking restart
  也可以重启网卡
  sudo ifconfig eth0 down 
  sudo ifconfig eth0 up
  
  
  B 修改 resolvconf服务的配置文件: /etc/resolvconf/resolv.conf.d/base 
  
  echo "search test.com" >> /etc/resolvconf/resolv.conf.d/base 
  echo "nameserver 202.106.0.20 " >> /etc/resolvconf/resolv.conf.d/base 
  这样，在机器重启或 resolvconf 服务重启 都可以保证配置会写到/etc/resolv.conf 里面 
  
  重启 resolvconf 服务
  
  service resolvconf restart
  
  A比B的优先级更高,,不过可能会断网.
  ```

  
# 三. 参考
* [ Linux操作系统加固](https://help.aliyun.com/knowledge_detail/49809.html)
